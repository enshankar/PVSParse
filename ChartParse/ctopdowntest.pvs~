ctopdowntest 	: THEORY

  BEGIN
   IMPORTING ctopdown

   digit(x: byte): bool = (x >= 48 AND x <= 57)
   any(x: byte): bool = TRUE
   

   pyaml(n: non_terminal): peg =
   COND n OF
    0: choice(1, 3),  %data -> numeral / adata
    1: concat(2, 1),  %numeral -> any(48-57) o numeral
    2: any(digit),
    3: choice(4, _),  %adata -> dict / array
    4: concat(5, 11),  %dict -> obrace o dictail
    5: concat(6, 7),  %obrace -> { o wspace
    6: terminal(123), %{
    7: choice(8, 10), %wspace ->  wspace$ / epsilon
    8: concat(9, 7),  %wspace$ -> terminal(32) o wspace
    9: terminal(32),  %space
    10: epsilon,
    11: choice(12, 14), %dictail -> cbrace / dictail$
    12: concat(7, 13), %cbrace -> wspace o terminal(125)
    13: terminal(125),
    14: concat(15, ), % dictail$ -> dictentry o dictailc
    15: concat(16, 28), %dictentry -> lhs o seprhs
    16: choice(1, 17),  %lhs -> numeral / token
    17: concat(18, 7), %token -> token$ o wspace
    18: concat(19, 25), %token$ -> terminal(39) o tokentail
    19: terminal(39),
    20: choice(21, 25), %tokentail-> esctail / qtail
    21: concat(22, 20), %esctail -> esquote o tokentail
    22: concat(23, 19), esquote -> terminal(92) o terminal(39)
    23: terminal(92),
    24: concat(19, 7), %quote -> terminal(39) o wspace
    25: choice(24, 26), %qtail -> quote / tktail
    26: concat(27, 20), %tktail -> any o tokentail
    27: any(any),
    28: concat(29, 0), %seprhs -> separator o data
    29: concat(30, 7), %separator -> terminal(58) o wspace
    30: terminal(58)
    ELSE epsilon
  ENDCOND
  

  END ctopdowntest
